# Building Secure Microservices-based Applications Using Service-Mesh Architecture和訳

個人的な勉強のため，NIST SP 800-204a "Building Secure Microservices-based Applications Using Service-Mesh Architecture" を和訳していきます。原文は[こちら](https://csrc.nist.gov/publications/detail/sp/800-204a/final)です。

権限的に問題がありましたら公開を取りやめますので，お手数ですがご連絡ください。

技術的な内容はなるべく文意に沿って翻訳いたしますが，内容の正確さを保証するものではございません。  
また，謝辞など技術に関係ない節は省略しております。

なお，翻訳にあたり，[DEEPL](https://www.deepl.com/home)や[Google Translate](https://translate.google.co.jp/)を活用させていただいております。

---

NIST Special Publication 800-204A

## サービスメッシュアーキテクチャを用いたセキュアなマイクロサービス型アプリケーションの構築

- Ramaswamy Chandramouli, Zack Butcher著
- https://doi.org/10.6028/NIST.SP.800-204A
- 2020年5月

## コンピュータシステム技術に関する報告書

国立標準技術研究所(NIST; National Institute of Standards and Technology)の情報技術研究所(ITL; The Information Technology Laboratory)は，国家の測定・標準基盤において技術的リーダーシップを提供することにより米国経済と公共の福祉を促進するものである。ITLは，情報技術の開発と生産的な利用促進のため，テスト，テスト方法，参照データ，PoC実装，技術的分析を開発するものである。ITLの責任には，連邦政府の情報システムにおいて国家安全保障関連情報以外の情報に対して，費用対効果の高いセキュリティとプライバシーを提供するための管理，運営，技術，物理における標準規格およびガイドラインの開発を含んでいる。Special Publication 800シリーズは，情報システムセキュリティにおけるITLの研究やガイドライン，支援活動，および産業界，政府，学術機関との協力活動を報告するものである。

## 要旨

構築の傾向が高まっているマイクロサービス型アプリケーションは，そのユニークな特徴から，サービス間の相互作用についてあらゆる側面からセキュリティ的な対処が必要である。
分散した複数ドメインをマイクロサービスの性質から，セキュアなトークンサービス（STS; Secure Token Service），認証・認可のための鍵管理および暗号化のサービス，およびセキュアな通信プロトコルが必要である。
（マイクロサービスを構成する）クラスタ化されたコンテナは短命であるため，セキュアなサービスディスカバリが必要である。
同様に，可用性には (a)ロードバランシング，サーキットブレイキング，スロットリングのような回復力の技術，(b)（サービス安定稼働のための）継続的な監視，という要件がある。*サービスメッシュ*は，これら要件を抽象的なレベルで容易に指定できるようにする最もよく知られたアプローチであり，均一かつ一貫性を持った定義ができる上，個々のマイクロサービスのコードの変更なしで組み込めるものである。本文書の目的は，マイクロサービス型アプリケーション支援のため，頑強なセキュリティ基盤を形成するプロキシベースのサービスメッシュコンポーネントの構築ガイダンスを提供することである。

## キーワード

APIゲートウェイ，アプリケーション プログラミング インタフェース(API)，サーキットブレイカー，ロードバランシング，マイクロサービス，サービスメッシュ，サービスプロキシ

## 注意 特許開示通知

情報技術研究所（ITL）は，この出版物のガイダンスまたは要件に準拠するために使用が必要となる可能性のある特許クレームの所有者に，特許クレームをITLへ開示することを要求している。ただし，特許の保有者は，ITLの特許請求に応答する義務はなく，ITLはこの出版物に適用される可能性のある特許を特定する調査を行っていない。出版日現在，また本書のガイダンスまたは要件に準拠するために使用が必要となる可能性のある特許クレームを特定するための募集を行った時点は，このような特許クレームはITLに確認されていない。 ITLは，この出版物の使用における特許侵害を回避するためにライセンスが必要でないことを表明または暗示するものではない。

## エグゼクティブサマリ

マイクロサービスベースのアプリケーション・アーキテクチャは，そのスケーラビリティ，デプロイの俊敏性，ツールの可用性の高さから，クラウドベースのアプリケーションや大規模なエンタープライズ・アプリケーションを構築する際の規範となりつつある。同時に，マイクロサービスベースのアプリケーションの特性は，セキュリティ要件の変更や強化をもたらす。

これら特性とそのセキュリティへの影響におけるいくつか例は次のとおりである。

1. マイクロサービスの数が膨大になると，相互接続が多くなり，保護すべき通信リンクも増加する
2. マイクロサービスの短命の性質は，安全なサービスディスカバリの仕組みを必要とする
3. 細分化されたマイクロサービスの性質は，きめ細かな認可ポリシーを必要とする

マイクロサービスベースのアプリケーションのためにサポートされるサービス（認証/認可，セキュリティ監視など）は，サービスメッシュのような専用のインフラを介してしっかりと調整されなければならない。サービスメッシュのコンポーネントをデプロイする方法は複数ある。アプリケーション（マイクロサービス）のコードに組み込む方法，ライブラリとして実装してアプリケーションのコードに結合する方法，アプリケーションコードから独立したサービスプロキシとして実装する方法などである。最後のデプロイ方法は，マイクロサービスベースのアプリケーションを支援するインフラを実装する多くのシナリオにおいて，スケーラビリティと柔軟性の点で最も効率的であることがわかっている。

本ドキュメントの目的は，サービスプロキシベースのアプローチにおけるサービスメッシュ・コンポーネントのデプロイガイダンスを提供することである。サービスメッシュのデプロイにおける推奨事項は以下の通りである

- サービスプロキシ間の通信設定
- イングレスプロキシの設定
- 外部サービスへのアクセス設定
- IDやアクセス管理の設定
- 監視機能の設定
- ネットワークレジリエンスの設定
- オリジン間リソース共有（CORS）の設定
- 管理者権限の設定

## 1. 序論

マイクロサービスアーキテクチャはエンタープライズやクラウドベースのアプリケーションを構築するための確立されたアプローチになっている。これは次の理由からである:

- 俊敏性: マイクロサービス群の疎結合性とモジュール性の向上により，他のコンポーネント（マイクロサービス）に影響を与えることなく独立的に迅速な修正やデプロイが可能となる
- スケーラビリティ: マイクロサービスの特性により，個々のマイクロサービスを独立に拡張できる
- 利便性: 明確に定義されたAPIを使用し，様々はマイクロサービスの統合や受け入れが可能となる
- ツールの可用性: 自動化ツールの可用性の向上はエラーのない設定とデプロイを容易になる

上記の利点にもかかわらず，マイクロサービスベースのアプリケーションアーキテクチャにはセキュリティ要件の修正や強化を伴う以下の課題がある。

- マイクロサービスが多くなるに伴い，コンポーネント間の接続や保護すべき通信リンクが増加する
- コンポーネント（マイクロサービス）が動的に生成・削除されるため，セキュアなサービスディスカバリが必要となる
- ネットワークの境界線という概念がない
- すべてのマイクロサービスは信頼できないものとして扱わなければならない
- マイクロサービスのきめ細かな性質は，マイクロサービスごとの細かな認証を必要とする。それには，セキュリティポリシーを一元的に定義し，その設定を各マイクロサービスに反映することで，マイクロサービス全体に渡って統一的かつ一貫性のある運用を可能にする必要がある

### 1.1 何故サービスメッシュか (Why Service Mesh)

上述のマイクロサービスベースのアプリケーションセキュリティ要件のため，アプリケーションを補助するインフラと，そのインフラに関連するサービス（例えばセキュリティ）は，緊密に連携されている必要がある。
サービスメッシュはそのような専用のインフラの一つである。
サービスメッシュを実現するコードは，マイクロサービスベースのアプリケーションアーキテクチャのコンポーネントに関して，以下のように体系づけられる（各アーキテクチャパターンは，SM-ARxという頭字語を用いて表記されます（SMはサービスメッシュ，ARはアーキテクチャ，xはシーケンス番号）。

- SM-AR1: サービスメッシュのコードはマイクロサービスアプリケーションのコードに組み込むことができ，アプリケーション開発フレームワークにとって不可欠な部分となる。
- SM-AR2: サービスメッシュのコードはライブラリとして実装され，アプリケーションはAPI呼び出しを介してサービスメッシュが提供する機能に結合される
- SM-AR3: サービスメッシュの機能はプロキシ内に実装されている。各プロキシはマイクロサービスインスタンス[^1]の前に配置され，マイクロサービスベースのアプリケーションにインフラサービスをまとめて提供する。このプロキシは「サイドカープロキシ」と呼ばれ，アプリケーションコードから独立した実装・運用が可能である。サイドカープロキシは種々のプラットフォーム（異なる言語や異なるアプリケーション開発フレームワーク）にとって最小公分母のAPIであるネットワークを採用することにより，これらの一貫した制御を可能とする。
- SM-AR4: サービスメッシュの機能はプロキシに実装されるが，SM-AR3のようなマイクロサービスインスタンスごとではなく，ノード（物理ホスト）ごと配置される

[1]: 訳者注: マイクロサービスインスタンスはコンテナなどの個々のマイクロサービスを構成するコンポーネントを指す

1.2 スコープ

本文書の目的のため，サービスメッシュのアーキテクチャはSM-AR3の構成のみを検討する。この専用インフラレイヤはアプリケーションのサービスコードを修正することなく，マイクロサービスベースのアプリケーションにあらゆるセキュリティ機能を提供する。SM-AR4と比べ，